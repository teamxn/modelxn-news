<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ModelXN News | ৩টি সোর্স থেকে সংবাদ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root { --primary: #c0392b; --dark: #111; --light: #f4f4f4; --card-bg: #fff; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Noto Sans Bengali', sans-serif; background: #f0f2f5; color: #333; }
  
  /* Header */
  header { background: var(--dark); color: #fff; padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--primary); }
  .logo h1 { font-size: 1.8rem; font-weight: 900; }
  .logo span { color: var(--primary); }
  
  /* Weather Widget */
  .weather-box { background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
  .weather-box i { color: #f1c40f; }

  /* Layout */
  .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }
  .section-head { display: flex; align-items: center; gap: 10px; margin: 30px 0 15px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
  .section-head h2 { font-size: 1.4rem; color: var(--dark); }
  .section-head i { color: var(--primary); }

  /* Grid System */
  .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
  .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }

  /* Cards */
  .news-card { background: var(--card-bg); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: 0.3s; display: flex; flex-direction: column; }
  .news-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
  .card-img { height: 180px; background: #ddd; position: relative; }
  .card-img img { width: 100%; height: 100%; object-fit: cover; }
  .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; }
  .card-source { font-size: 0.7rem; color: var(--primary); font-weight: bold; text-transform: uppercase; margin-bottom: 5px; }
  .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; line-height: 1.4; color: #1a1a1a; }
  .card-meta { margin-top: auto; font-size: 0.8rem; color: #777; display: flex; justify-content: space-between; border-top: 1px solid #eee; padding-top: 10px; }

  /* Admin Card */
  .admin-card { border: 2px solid var(--primary); background: #fff5f5; }
  .admin-badge { background: var(--primary); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; }

  /* Footer */
  footer { background: var(--dark); color: #aaa; text-align: center; padding: 30px; margin-top: 50px; }
</style>
</head>
<body>

<header>
  <div class="logo">
    <h1>Model<span>XN</span></h1>
  </div>
  <div class="weather-box" id="weather-display">
    <i class="fas fa-spinner fa-spin"></i> লোড হচ্ছে...
  </div>
</header>

<div class="container">

  <div id="admin-section" style="display:none;">
    <div class="section-head">
      <i class="fas fa-star"></i> <h2>সম্পাদকীয় (Admin Picks)</h2>
    </div>
    <div class="grid-3" id="admin-grid"></div>
  </div>

  <div class="section-head">
    <i class="fas fa-newspaper"></i> <h2>ব্রেকিং নিউজ (GNews Source)</h2>
  </div>
  <div class="grid-3" id="gnews-grid">
    <p>সংবাদ লোড হচ্ছে...</p>
  </div>

  <div class="section-head">
    <i class="fas fa-globe-asia"></i> <h2>সর্বশেষ আপডেট (NewsData Source)</h2>
  </div>
  <div class="grid-4" id="newsdata-grid">
    <p>সংবাদ লোড হচ্ছে...</p>
  </div>

</div>

<footer>
  <p>&copy; ২০২৬ ModelXN News | Developed by Shuvo Bro</p>
</footer>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ─── ১. ৩টি API KEY কনফিগারেশন ─── */
const API_KEYS = {
  GNEWS: '137053cf0244c5090b6fd16bfcebccc7',           // GNews
  NEWSDATA: 'pub_61fbb227c3654dd99d61b192b9a26e9a',    // NewsData
  WEATHER: '622c4de5ee05cbfb7e93716f7b4324bf'          // OpenWeather
};

const FIREBASE_CONFIG = {
  apiKey: "AIzaSyB3X2kp_KR96uV1Mh4vqKDKsdAQv3rXOxU",
  authDomain: "baby-75d6e.firebaseapp.com",
  projectId: "baby-75d6e",
  storageBucket: "baby-75d6e.firebasestorage.app",
  messagingSenderId: "1018260950671",
  appId: "1:1018260950671:web:12388b977b6fd9fbbf2afa"
};

/* ─── ২. API 1: WEATHER FUNCTION ─── */
async function loadWeather() {
  const url = `https://api.openweathermap.org/data/2.5/weather?q=Rajshahi&units=metric&lang=bn&appid=${API_KEYS.WEATHER}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    if (data.main) {
      document.getElementById('weather-display').innerHTML = `
        <i class="fas fa-cloud-sun"></i> 
        <span>${data.name}: ${Math.round(data.main.temp)}°C, ${data.weather[0].description}</span>
      `;
    }
  } catch (e) {
    document.getElementById('weather-display').innerHTML = '<i class="fas fa-exclamation-circle"></i> আবহাওয়া অফলাইন';
  }
}

/* ─── ৩. API 2: GNEWS FUNCTION ─── */
async function loadGNews() {
  const container = document.getElementById('gnews-grid');
  // GNews থেকে টপ হেডলাইন আনবে
  const url = `https://gnews.io/api/v4/top-headlines?country=bd&lang=bn&max=3&apikey=${API_KEYS.GNEWS}`;
  
  try {
    const res = await fetch(url);
    const data = await res.json();
    
    if (data.articles) {
      container.innerHTML = '';
      data.articles.forEach(item => {
        container.innerHTML += createCard(item.title, item.source.name, item.image, item.url, item.publishedAt);
      });
    } else {
      container.innerHTML = '<p>GNews কোটা শেষ বা ডাটা নেই।</p>';
    }
  } catch (e) { container.innerHTML = '<p>GNews লোড হতে সমস্যা।</p>'; }
}

/* ─── ৪. API 3: NEWSDATA FUNCTION ─── */
async function loadNewsData() {
  const container = document.getElementById('newsdata-grid');
  // NewsData থেকে আরও খবর আনবে
  const url = `https://newsdata.io/api/1/news?apikey=${API_KEYS.NEWSDATA}&country=bd&language=bn`;
  
  try {
    const res = await fetch(url);
    const data = await res.json();
    
    if (data.results) {
      container.innerHTML = '';
      data.results.forEach(item => {
        // NewsData তে ছবির ফিল্ড হলো image_url
        let img = item.image_url ? item.image_url : 'https://via.placeholder.com/300x200?text=News+Update';
        container.innerHTML += createCard(item.title, item.source_id, img, item.link, item.pubDate);
      });
    } else {
      container.innerHTML = '<p>NewsData সার্ভার রেসপন্স করছে না।</p>';
    }
  } catch (e) { container.innerHTML = '<p>NewsData লোড হতে সমস্যা।</p>'; }
}

/* ─── ৫. FIREBASE ADMIN FUNCTION ─── */
try {
  firebase.initializeApp(FIREBASE_CONFIG);
  const db = firebase.firestore();
  
  db.collection("news").orderBy("timestamp", "desc").limit(3).onSnapshot(snap => {
    const section = document.getElementById('admin-section');
    const grid = document.getElementById('admin-grid');
    
    if (!snap.empty) {
      section.style.display = 'block';
      grid.innerHTML = '';
      snap.forEach(doc => {
        const d = doc.data();
        grid.innerHTML += `
          <div class="news-card admin-card">
            <div class="card-body">
              <div class="card-source"><span class="admin-badge">ADMIN</span> ModelXN</div>
              <div class="card-title">${d.title}</div>
              <p style="font-size:0.9rem; color:#555;">${d.content}</p>
              <div class="card-meta">
                <span><i class="fas fa-clock"></i> Just Now</span>
              </div>
            </div>
          </div>
        `;
      });
    }
  });
} catch(e) { console.log('Firebase Error'); }

/* ─── কার্ড জেনারেটর (Design Template) ─── */
function createCard(title, source, img, link, date) {
  // যদি ছবি না থাকে ডিফল্ট ছবি বসাবে
  const image = img ? img : 'https://via.placeholder.com/300x200?text=ModelXN';
  const time = date ? new Date(date).toLocaleDateString('bn-BD') : 'সদ্য';
  
  return `
    <div class="news-card">
      <div class="card-img">
        <img src="${image}" onerror="this.src='https://via.placeholder.com/300x200?text=Error'">
      </div>
      <div class="card-body">
        <div class="card-source">${source}</div>
        <a href="${link}" target="_blank" style="text-decoration:none;">
          <div class="card-title">${title}</div>
        </a>
        <div class="card-meta">
          <span><i class="far fa-clock"></i> ${time}</span>
          <span style="color:var(--primary); cursor:pointer;" onclick="window.open('${link}')">পড়ুন <i class="fas fa-arrow-right"></i></span>
        </div>
      </div>
    </div>
  `;
}

/* ─── RUN EVERYTHING ─── */
window.onload = () => {
  loadWeather();   // API 1 Call
  loadGNews();     // API 2 Call
  loadNewsData();  // API 3 Call
};
</script>

</body>
</html>
